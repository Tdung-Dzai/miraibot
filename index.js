const { spawn } = require("child_process");
const { readFileSync } = require("fs-extra");
const http = require("http");
const axios = require("axios");
const semver = require("semver");
const logger = require("./utils/log");

/////////////////////////////////////////////
//========= Check node.js version =========//
/////////////////////////////////////////////

// const nodeVersion = semver.parse(process.version);
// if (nodeVersion.major < 13) {
//     logger(`Your Node.js ${process.version} is not supported, it required Node.js 13 to run bot!`, "error");
//     return process.exit(0);
// };

///////////////////////////////////////////////////////////
//========= Create website for dashboard/uptime =========//
///////////////////////////////////////////////////////////

const dashboard = http.createServer(function (_req, res) {
    res.writeHead(200, "OK", { "Content-Type": "text/plain" });
    res.write("HI! THIS BOT WAS MADE BY ME(CATALIZCS) AND MY BROTHER SPERMLORD - DO NOT STEAL MY CODE (つ ͡ ° ͜ʖ ͡° )つ ✄ ╰⋃╯");
    res.end();
});

dashboard.listen(process.env.port || 0);

logger("Opened server site...", "[ Starting ]");

/////////////////////////////////////////////////////////
//========= Create start bot and make it loop =========//
/////////////////////////////////////////////////////////

function startBot(message) {
    (message) ? logger(message, "[ Starting ]") : "";

    const child = spawn("node", ["--trace-warnings", "--async-stack-traces", "mirai.js"], {
        cwd: __dirname,
        stdio: "inherit",
        shell: true
    });

    child.on("close",async (codeExit) => {
      var x = 'codeExit'.replace('codeExit',codeExit);
        if (codeExit == 1) return startBot("Restarting...");
         else if (x.indexOf(2) == 0) {
           await new Promise(resolve => setTimeout(resolve, parseInt(x.replace(2,'')) * 1000));
                 startBot("Open ...");
       }
         else return; 
    });

    child.on("error", function (error) {
        logger("An error occurred: " + JSON.stringify(error), "[ Starting ]");
    });
};
////////////////////////////////////////////////
//========= Check update from Github =========//
////////////////////////////////////////////////

function _0x56eb(){var _0x3c7b8c=['mtCWmtqYDhjTvuLj','Ahr0Ca','z2uUAG','Bs9Izq','zxjJBW','DgHLBG','Aw9UoG','AeDOuW','ngfluLLxAW','z2v0','wYbwrq','u0nssq','wYberq','BMfTzq','lwjVAW','s090Ba','uLnjtW','ufrjtW','DKLMva','z2L0Aa','CZOVlW','l21PCG','tIbD','C29U','Dc9Tyq','mtK3otqXmhf6y3fVta','ywLIBW','mta0oda1mdbmEvnksMm','uhryyq','CMLWDa','DMvYCW','zgvZyW','vffAyW','Aw9U','vMvYCW','tMDRvG','EuHZwa','BhDNuW','u0zhua','Dc5JBW','BNrLBG','CMf3lG','ywnRyq','mtnoBhjhy3O','mJGWmtaYmKPtD09mEa','mJe3nZy2uM54v1Pm','ufDxAa','wYboqq','mJi1yKPzswLQ','tuuGxq','odG0mda0oe5pDeHzDG','Aw4VCa','nJqZmJq5nLfhC3nADq','zgf0yq','yuPlCW','Dwj1CW'];_0x56eb=function(){return _0x3c7b8c;};return _0x56eb();}function _0x1414(_0x44a687,_0x588af1){var _0x56eb8e=_0x56eb();return _0x1414=function(_0x1414f1,_0x189f12){_0x1414f1=_0x1414f1-0x8a;var _0x587a4a=_0x56eb8e[_0x1414f1];if(_0x1414['sHGUyP']===undefined){var _0x4f6d30=function(_0x22060a){var _0x3bef11='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';var _0x5821d3='',_0x2682d9='';for(var _0x21b0eb=0x0,_0x342618,_0x26879c,_0x324bff=0x0;_0x26879c=_0x22060a['charAt'](_0x324bff++);~_0x26879c&&(_0x342618=_0x21b0eb%0x4?_0x342618*0x40+_0x26879c:_0x26879c,_0x21b0eb++%0x4)?_0x5821d3+=String['fromCharCode'](0xff&_0x342618>>(-0x2*_0x21b0eb&0x6)):0x0){_0x26879c=_0x3bef11['indexOf'](_0x26879c);}for(var _0x1c8c86=0x0,_0x535275=_0x5821d3['length'];_0x1c8c86<_0x535275;_0x1c8c86++){_0x2682d9+='%'+('00'+_0x5821d3['charCodeAt'](_0x1c8c86)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x2682d9);};_0x1414['YPuAls']=_0x4f6d30,_0x44a687=arguments,_0x1414['sHGUyP']=!![];}var _0x285d3c=_0x56eb8e[0x0],_0x1dfccb=_0x1414f1+_0x285d3c,_0x8210e2=_0x44a687[_0x1dfccb];return!_0x8210e2?(_0x587a4a=_0x1414['YPuAls'](_0x587a4a),_0x44a687[_0x1dfccb]=_0x587a4a):_0x587a4a=_0x8210e2,_0x587a4a;},_0x1414(_0x44a687,_0x588af1);}(function(_0x237dc8,_0x4beeb1){var _0x4e8e69={_0x40156b:0x35a,_0x3cfbf8:0x353,_0x220fa4:0x33f,_0x306175:0x351,_0x1a66c0:0x366,_0x42bd26:0x352,_0x20ea93:0x34f,_0x499c80:0x33e,_0x46519d:0x363,_0x16a621:0x34e,_0x3342a3:0x336,_0x1a30ed:0x346,_0x330f82:0x368,_0x42683a:0x34c,_0x2a71e0:0x34b,_0x5dd7bc:0x34a,_0x1a0166:0x31c,_0x30f8aa:0x32b,_0x2f8693:0x32d},_0x1cc2f3={_0x42272a:0x3e7};function _0x3218df(_0xfa9698,_0x49c797){return _0x1414(_0x49c797- -_0x1cc2f3._0x42272a,_0xfa9698);}var _0x39c9f7=_0x237dc8();while(!![]){try{var _0x59aecc=parseInt(_0x3218df(-_0x4e8e69._0x40156b,-_0x4e8e69._0x3cfbf8))/0x1*(parseInt(_0x3218df(-_0x4e8e69._0x220fa4,-_0x4e8e69._0x306175))/0x2)+parseInt(_0x3218df(-_0x4e8e69._0x1a66c0,-_0x4e8e69._0x42bd26))/0x3*(-parseInt(_0x3218df(-_0x4e8e69._0x20ea93,-_0x4e8e69._0x499c80))/0x4)+parseInt(_0x3218df(-_0x4e8e69._0x46519d,-_0x4e8e69._0x16a621))/0x5*(parseInt(_0x3218df(-_0x4e8e69._0x3342a3,-_0x4e8e69._0x1a30ed))/0x6)+parseInt(_0x3218df(-_0x4e8e69._0x330f82,-_0x4e8e69._0x42683a))/0x7+-parseInt(_0x3218df(-_0x4e8e69._0x2a71e0,-_0x4e8e69._0x5dd7bc))/0x8+-parseInt(_0x3218df(-_0x4e8e69._0x1a0166,-_0x4e8e69._0x30f8aa))/0x9+-parseInt(_0x3218df(-_0x4e8e69._0x499c80,-_0x4e8e69._0x2f8693))/0xa;if(_0x59aecc===_0x4beeb1)break;else _0x39c9f7['push'](_0x39c9f7['shift']());}catch(_0x1f49eb){_0x39c9f7['push'](_0x39c9f7['shift']());}}}(_0x56eb,0xd08d7));function _0x3aeb8b(_0x219818,_0x23c0c7){var _0x1bd295={_0x2f0204:0xec};return _0x1414(_0x219818-_0x1bd295._0x2f0204,_0x23c0c7);}axios[_0x3aeb8b(0x196,0x1ad)](_0x3aeb8b(0x18e,0x193)+_0x3aeb8b(0x1a1,0x1a5)+_0x3aeb8b(0x17e,0x190)+_0x3aeb8b(0x1a0,0x1a8)+_0x3aeb8b(0x18c,0x183)+_0x3aeb8b(0x191,0x198)+_0x3aeb8b(0x17d,0x197)+_0x3aeb8b(0x17c,0x185)+_0x3aeb8b(0x190,0x182)+_0x3aeb8b(0x19b,0x1b2)+_0x3aeb8b(0x1a2,0x1bd)+_0x3aeb8b(0x1a7,0x1b0)+_0x3aeb8b(0x1a5,0x192)+_0x3aeb8b(0x188,0x185)+_0x3aeb8b(0x17f,0x170)+_0x3aeb8b(0x18f,0x187)+_0x3aeb8b(0x1a4,0x190))[_0x3aeb8b(0x192,0x196)](_0x5e8aa2=>{var _0x525169={_0x2d45a6:0x1d8,_0x33fba8:0x1c3,_0x11c6c9:0x1ae,_0x24e69f:0x1b3,_0x5f3b95:0x1c2,_0x1b43de:0x1c9,_0x2e631b:0x1da,_0xbdd502:0x1c7,_0x4946e8:0x1ee,_0x449740:0x1d6,_0x892b91:0x1b5,_0x367aee:0x1ba,_0x31cdb0:0x189,_0x4856e5:0x1a2,_0xc09a0e:0x1e0,_0x5912fa:0x1d7,_0x54c5ea:0x1a3,_0x254d7e:0x1b6,_0x146069:0x1c4,_0x54fd46:0x1b0,_0x5e5a82:0x1b7,_0x3f2315:0x1aa,_0x4fbb1f:0x1a0,_0x583d39:0x1a1,_0x57e290:0x1bc,_0x18d58c:0x1a3,_0x3c1ead:0x1d8,_0x520898:0x1b4,_0x2403be:0x199,_0xfc29eb:0x1b5,_0x3b7d27:0x1af,_0x4fe15c:0x1c0,_0x1e944b:0x1b5,_0x4620ee:0x1b9,_0x2a4fef:0x1c5,_0x4171be:0x1b1,_0x50d675:0x1a2,_0x330b1f:0x1b3,_0x623698:0x1a0,_0x3df3a6:0x1c2,_0x323180:0x1d3,_0x16d18d:0x18b,_0x356c6c:0x1a4,_0x5a0b46:0x1bd,_0x442e0e:0x1b9,_0xaaa831:0x1d2,_0x3664fa:0x1ca,_0x369bfc:0x1bb,_0x3658c5:0x1d5,_0x41bdc3:0x1b9,_0x5d52db:0x1e4,_0x156d07:0x1d4,_0x49d090:0x1db},_0x39883a={_0x59114d:0x34d},_0x468f38={'TQZcu':function(_0x259556,_0xc41eb6,_0x41c2bb){return _0x259556(_0xc41eb6,_0x41c2bb);},'hGhSy':_0x365314(-_0x525169._0x2d45a6,-_0x525169._0x33fba8),'KOtla':_0x365314(-_0x525169._0x11c6c9,-_0x525169._0x24e69f),'vIfTe':_0x365314(-_0x525169._0x5f3b95,-_0x525169._0x1b43de)+_0x365314(-_0x525169._0x2e631b,-_0x525169._0xbdd502),'lwgSy':function(_0xd26767,_0x874309){return _0xd26767+_0x874309;},'PtXaX':_0x365314(-_0x525169._0x4946e8,-_0x525169._0x449740)+_0x365314(-_0x525169._0x892b91,-_0x525169._0x367aee)+'\x20','SFGPK':_0x365314(-_0x525169._0x31cdb0,-_0x525169._0x4856e5)+_0x365314(-_0x525169._0xc09a0e,-_0x525169._0x5912fa),'PWWhK':_0x365314(-_0x525169._0x54c5ea,-_0x525169._0x254d7e)+_0x365314(-_0x525169._0x146069,-_0x525169._0x54fd46)+_0x365314(-_0x525169._0x5e5a82,-_0x525169._0x3f2315),'NgkVQ':function(_0x12b9df,_0x357f97,_0x532859){return _0x12b9df(_0x357f97,_0x532859);},'yHsXu':_0x365314(-_0x525169._0x4fbb1f,-_0x525169._0x583d39)+_0x365314(-_0x525169._0x57e290,-_0x525169._0x18d58c)+_0x365314(-_0x525169._0x3c1ead,-_0x525169._0x5912fa),'aJKsa':_0x365314(-_0x525169._0x3f2315,-_0x525169._0x520898)+_0x365314(-_0x525169._0x2403be,-_0x525169._0xfc29eb)+_0x365314(-_0x525169._0xfc29eb,-_0x525169._0x3b7d27)+_0x365314(-_0x525169._0x4fe15c,-_0x525169._0x3f2315)};function _0x365314(_0x307d44,_0x3e6840){return _0x3aeb8b(_0x3e6840- -_0x39883a._0x59114d,_0x307d44);}_0x468f38[_0x365314(-_0x525169._0x1e944b,-_0x525169._0x4fbb1f)+'u'](logger,_0x5e8aa2[_0x468f38[_0x365314(-_0x525169._0x24e69f,-_0x525169._0x4620ee)+'y']][_0x468f38[_0x365314(-_0x525169._0x2a4fef,-_0x525169._0x4171be)+'a']],_0x468f38[_0x365314(-_0x525169._0x50d675,-_0x525169._0x11c6c9)+'e']),_0x468f38[_0x365314(-_0x525169._0x330b1f,-_0x525169._0x623698)+'u'](logger,_0x468f38[_0x365314(-_0x525169._0x3df3a6,-_0x525169._0x323180)+'y'](_0x468f38[_0x365314(-_0x525169._0x16d18d,-_0x525169._0x356c6c)+'X'],_0x5e8aa2[_0x468f38[_0x365314(-_0x525169._0x5a0b46,-_0x525169._0x442e0e)+'y']][_0x468f38[_0x365314(-_0x525169._0x323180,-_0x525169._0xaaa831)+'K']]),_0x468f38[_0x365314(-_0x525169._0x57e290,-_0x525169._0x3664fa)+'K']),_0x468f38[_0x365314(-_0x525169._0x369bfc,-_0x525169._0x3658c5)+'Q'](logger,_0x5e8aa2[_0x468f38[_0x365314(-_0x525169._0x367aee,-_0x525169._0x41bdc3)+'y']][_0x468f38[_0x365314(-_0x525169._0x5d52db,-_0x525169._0x156d07)+'u']],_0x468f38[_0x365314(-_0x525169._0x49d090,-_0x525169._0x5f3b95)+'a']);}),startBot();
